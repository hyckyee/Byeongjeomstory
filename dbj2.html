<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>병점스토리</title>
    <style>
        /* Add your CSS styles here */
    </style>
</head>
<body>
    <h1>병점스토리</h1>

    <label for="dateInput">날짜 선택: </label>
    <input type="date" id="dateInput">

    <div id="timetable">
        <h2>시간표</h2>
        <ul id="timetableList"></ul>
    </div>

    <div id="meal">
        <h2>급식</h2>
        <ul id="mealList"></ul>
    </div>

    <script>
        // NEIS API endpoint URLs
        const timetableURL = 'https://open.neis.go.kr/hub/hisTimetable';
        const mealURL = 'https://open.neis.go.kr/hub/mealServiceDietInfo';
        const apiKey = 'fbffee9d42554d4287deb7e938e1b9bc';

        // Function to fetch timetable data for a specific date
        async function fetchTimetable(date) {
            try {
                const response = await fetch(`${timetableURL}?KEY=${apiKey}&Type=json&GRADE=1&date=${date}`);
                const data = await response.json();
                console.log("Timetable API Response:", data); // Log the JSON response

                // Check if the response contains timetable data
                if (data && data['hisTimetable']) {
                    return data['hisTimetable'];
                } else {
                    throw new Error('Invalid timetable data received from the API');
                }
            } catch (error) {
                console.error("Error fetching timetable data:", error);
            }
        }

        // Function to fetch meal data for a specific date
        async function fetchMeal(date) {
            try {
                const response = await fetch(`${mealURL}?KEY=${apiKey}&Type=json&ATPT_OFCDC_SC_CODE=J10&SD_SCHUL_CODE=7530627&MLSV_YMD=${date}`);
                const data = await response.json();
                console.log("Meal API Response:", data); // Log the JSON response

          // Function to fetch meal data for a specific date
async function fetchMeal(date) {
    try {
        const response = await fetch(`${mealURL}?KEY=${apiKey}&Type=json&ATPT_OFCDC_SC_CODE=J10&SD_SCHUL_CODE=7530627&MLSV_YMD=${date}`);
        const data = await response.json();
        console.log("Meal API Response:", data); // Log the JSON response

        // Check if the response contains meal data
        if (data && data['mealServiceDietInfo']) {
            return data['mealServiceDietInfo'];
        } else {
            console.error('No meal data found in the response');
            return null; // Return null to indicate no meal data
        }
    } catch (error) {
        console.error("Error fetching meal data:", error);
    }
}

        }

        // Function to display timetable for a specific date
        async function displayTimetable(date) {
            const timetableData = await fetchTimetable(date);
            if (timetableData) {
                const timetableList = document.getElementById('timetableList');
                timetableList.innerHTML = ''; // Clear any existing timetable items
                timetableData.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `반: ${item.ITRT_CNTNT}, 과목: ${item.MME_SUBJ_NM}, 시간: ${item.ALL_TIEM}`;
                    timetableList.appendChild(li);
                });
            }
        }

        // Function to display meal information for a specific date
        async function displayMeal(date) {
            const mealData = await fetchMeal(date);
            if (mealData) {
                const mealList = document.getElementById('mealList');
                mealList.innerHTML = ''; // Clear any existing meal items
                mealData.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `날짜: ${item.MLSV_YMD}, 급식: ${item.DDISH_NM}`;
                    mealList.appendChild(li);
                });
            }
        }

        // Function to handle date selection change
        document.getElementById('dateInput').addEventListener('change', function() {
            const selectedDate = this.value; // Get selected date from the input
            displayTimetable(selectedDate);
            displayMeal(selectedDate);
        });
    </script>
</body>
</html>
